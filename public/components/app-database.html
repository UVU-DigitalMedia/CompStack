<link rel="import" href="/bower_components/firebase-element/firebase.html">
<link rel="import" href="/bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="/bower_components/firebase-element/firebase-document.html">
<link rel="import" href="/bower_components/firebase-element/firebase-auth.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/bower_components/paper-card/paper-card.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">
<dom-module id="app-database">

    <template>

        <firebase-auth
            id="firebase_auth"
            statusKnown="{{statusKnown}}"
            user="{{user}}"
            provider="github"
            location="https://sweltering-fire-2420.firebaseio.com"
            on-login="onLogin"
            on-error="onLoginError">
        </firebase-auth>

        <paper-button on-tap="login">Login</paper-button>

        <template is="dom-if" if="{{user}}">
            {{user.github.username}}
            <paper-button on-click="logout">Logout</paper-button>
            <paper-button on-click="addCompetency">Add to the database</paper-button>
        </template>

        <firebase-collection id="collection_competencies"
            location="https://sweltering-fire-2420.firebaseio.com/competencies"
            data="{{competencies}}">
        </firebase-collection>

        <firebase-collection id="collection_courses"
            location="https://sweltering-fire-2420.firebaseio.com/courses"
            data="{{courses}}"
            order-by-child="department">
        </firebase-collection>

        <paper-material>

            <template is="dom-repeat" items="[[competencies]]" as="competency">

                <paper-card heading="[[competency.__firebaseKey__]]">

                    <div class="card-content">[[competency.title]]</div>

                </paper-card>

            </template>

        </paper-material>

        <paper-material>

            <template is="dom-repeat" items="[[courses]]" as="course">

                <paper-card heading="[[course.__firebaseKey__]]">

                    <div class="card-content">

                        <ul>
                            <li><strong>Name:</strong> [[course.name]]</li>
                            <li><strong>Description:</strong> [[course.description]]</li>
                            <li><strong>Department:</strong> [[course.department]]</li>
                        </ul>

                    </div>

                </paper-card>

            </template>

        </paper-material>

    </template>

    <style>

        paper-material {

            width: 35%;
            display: inline-block;
            vertical-align: top;
            margin: 5px;
            background-color: white;

        }

        paper-card {

            margin: 5px;
        }


    </style>

    <script>

        Polymer({

            is: 'app-database',

            addCompetency: function(){

                this.$.firebase_auth.login({});
                this.$.collection_competencies.add({assesments : {}, course: "Test Compentency, No Courses", creator: "dev-tester", modified: Date(), modules: {}, title: "Test Competency" } )

            },

            login: function(){

                this.$.firebase_auth.login();

            },

            logout: function(){

                this.$.firebase_auth.logout();

            },

            onLogin: function() {

                console.log(user);

            }

        });

    </script>

</dom-module>
