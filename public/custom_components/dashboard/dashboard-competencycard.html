<dom-module id="dashboard-competencycard">

    <template>

        <firebase-document
            id="savedComp"
            path="/competencies/[[key]]"
            data="{{savedComp}}">
        </firebase-document>

        <firebase-document
            path="/users/[[competency.creator]]/displayName"
            data="{{creator}}">
        </firebase-document>

        <paper-card class$="[[cardClass]]">

                <div class="card-actions">

                    <h2>{{savedComp.$key}}</h2>

                    <iron-icon icon$="{{toggleIcon}}" on-tap="toggleOpen"></iron-icon>

                </div>

                <div class="card-content">

                    <dl>
                      <dt>Description</dt>
                        <dd id="description" contenteditable="true" on-blur="save">{{savedComp.title}}</dd>
                      <dt>Creator:</dt>
                        <dd id="creator">{{savedComp.creator}}</dd>
                      <dt>Course:</dt>
                        <dashboard-typeaheadinput id="course" path="/courses" value="{{savedComp.course}}" on-blur="save"></dashboard-typeaheadinput>
                      <dt>Last Modified:</dt>
                        <dd on-blur="save">{{savedComp.modified}}</dd>
                    </dl>

                </div>

        </paper-card>

    </template>

    <style>

        paper-card {

            vertical-align: top;
            margin: 10px;

        }

        .mini {

            width: 300px;

        }

        .large {

            width: 100%;

        }

        iron-icon {

            float: right;
            cursor: pointer;
        }

        h2 {

            width: 50%;
            height: 30px;
            overflow: hidden;
            display: inline-block;

        }

        dt {

            font-weight: bolder;
            padding: 0;
            margin: 0;

        }

        dd {

            margin-left: 15px;

        }


    </style>

    <script>

            Polymer({

                is: 'dashboard-competencycard',

                properties: {

                    key: String,

                    competency: {

                        type: Object,

                        notify: true

                    },

                    creator: Object,

                    cardClass: {

                        type: String,

                        value: 'mini'

                    },

                    toggleIcon: {

                        type: String,

                        value: 'icons:open-in-new'

                    },

                    hideEdit: {

                        type: Boolean,

                        value: true

                    }

                },

                ready: function() {

                    this.key = this.competency.$key;

                },

                toggleOpen: function() {

                    if(this.cardClass == 'mini'){

                        this.toggleIcon = 'icons:close';
                        this.cardClass = 'large';
                        this.hideEdit = false;

                    }
                    else {

                        this.toggleIcon = 'icons:open-in-new';
                        this.cardClass = 'mini';
                        this.hideEdit = true;

                    }
                },

                save: function() {

                    this.savedComp.course = this.$.course.value;
                    this.savedComp.title = this.$.description.textContent;
                    this.savedComp.modified = new Date().toString();

                    this.$.savedComp.save('/competencies', this.key)
                        .then(function(data){ console.log('Saved') })
                        .catch(function(data){ console.log('Not Saved ' + data) });

                }

            });

    </script>

</dom-module>
