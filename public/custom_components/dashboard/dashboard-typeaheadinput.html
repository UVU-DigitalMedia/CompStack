<dom-module id="dashboard-typeaheadinput">

    <template>

        <firebase-query
            id="courses"
            path="[[path]]"
            transactionsComplete="buildDataSet"
            data="{{courses}}">
        </firebase-query>

            <paper-input id='input' on-focus="showPredictions" on-keyup="predict" value={{value}}></paper-input>

            <div id="predictions" hidden$={{hide}}></div>

    </template>

    <style>

        .prediction{

            text-decoration: underline;
            font-weight: bold;
            color: gray;
            cursor: pointer;
            margin: 1em;

        }

    </style>

    <script>

        Polymer({

            is: 'dashboard-typeaheadinput',

            properties: {

                path: String,

                value: String,

                matchArray: {

                    type: Array,

                    value: []
                },

                courses: {

                    type: Object,

                    observer: 'buildDataSet'
                },

                hide: {

                    type: Boolean,
                    value: false
                }

            },

            buildDataSet: function() {

                for(course in this.courses)
                {

                    this.matchArray.push({course: this.courses[course].prefix + ' ' + this.courses[course].number, key: this.courses[course].$key})

                }

            },

            showPredictions: function() {

                this.buildDataSet();
                this.hide = false;

            },

            hidePredictions: function() {

                this.hide = true;

            },

            predict: function() {

                var matchCount = 0;
                var matchLimit = 4;

                while(this.$.predictions.firstChild) {

                    this.$.predictions.removeChild(this.$.predictions.firstChild);

                }

                for(course in this.matchArray)
                {

                    var length = this.value.length

                    if(this.matchArray[course].course.slice(0,length) == this.value){

                        var span = document.createElement('span');

                        span.className = 'prediction';

                        span.addEventListener('tap', this.fill.bind(this));

                        span.textContent = this.matchArray[course].course;

                        Polymer.dom(this.$.predictions).appendChild(span);

                        matchCount++;

                        if(matchCount >= matchLimit)
                        {

                            matchCount = 0;
                            break;

                        }

                    }

                }

            },


            fill: function(event) {

                this.value = event.srcElement.textContent;

                this.hide = true;

            }

        })

    </script>

</dom-module>
